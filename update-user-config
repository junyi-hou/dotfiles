#!/usr/bin/env nix-shell
#! nix-shell -i bash -p bash emacs
echo "start tangling modules..."
emacs -Q --batch main.org -f org-babel-tangle
echo "done"

./update-readme main.org README.org

x86_64_linux=`uname -a | grep -P "x86_64(.)+Linux"`

if [ -n "$x86_64_linux" ]; then
    nix build .#homeConfigurations.x86_64-linux.activationPackage
fi

x86_64_darwin=`uname -a | grep -P "x86_64(.)+Darwin"`

if [ -n "$x86_64_darwin" ]; then
    nix build .#homeConfigurations.x86_64-darwin.activationPackage
fi

./result/activate
